---
type: code
status: completed
labels:
- feature
- themes
target_files:
- internal/themes/themes.go
- internal/themes/themes_test.go
commits:
- c5b6657
completed_at: 2026-01-29T21:00:39Z
---
# Add Custom Color Profiles and Theme System

## Problem Description

The gradient package has hardcoded themes. Users cannot define custom color schemes or share theme files. A theme system would allow users to create, save, and load custom color profiles from `~/.config/moji/themes/`.

## Solution Approach

1. Create `internal/themes/` package for theme management
2. Support YAML theme files with color definitions
3. Auto-load themes from XDG config directory
4. Merge user themes with built-in themes
5. Add theme validation and error reporting

## Acceptance Criteria

- [x] Create `internal/themes/themes.go` with theme types
- [x] `Theme` struct with Name, Description, Colors, Metadata
- [x] `LoadTheme(path string) (*Theme, error)` from file
- [x] `LoadThemesDir(dir string) ([]Theme, error)` load all themes
- [x] `SaveTheme(theme *Theme, path string) error` save to file
- [x] `GetTheme(name string) (*Theme, error)` lookup by name
- [x] `ListThemes() []string` list all available themes
- [x] `RegisterTheme(theme *Theme)` add runtime theme
- [x] Auto-load from `~/.config/moji/themes/` on init
- [x] YAML format with colors as hex strings (#FF0000)
- [x] Validation for color format and theme structure
- [x] Unit tests with 80%+ coverage (82.8%)
- [x] go vet passes with no errors

## Technical Notes

- Theme YAML format:
  ```yaml
  name: "my-theme"
  description: "Custom neon colors"
  colors:
    - "#FF00FF"
    - "#00FFFF"
    - "#FFFF00"
  ```
- Use `gopkg.in/yaml.v3` for parsing
- Merge with existing gradient.Themes map

## Agent Output

2026-01-29T21:00:41Z

```
I'll start by understanding the spec and exploring the codebase to plan the implementation.
Let me explore the codebase structure to understand how moji is organized:
Good! Now I understand the codebase. I see this is a **Go project**, not Rust (the instructions mentioned Rust, but this is definitely Go). The spec asks for a theme system in `internal/themes/`. Let me examine the current gradient implementation more closely:
Let me also check the config structure to understand how to integrate themes:
Now let me check the existing test structure:
Perfect! Now I have a clear picture. Let me update the todo and plan my implementation:
Now let me create the themes package. First, I'll create the main themes.go file:
Now let me mark the first task as completed and create comprehensive unit tests:
Now let me mark the tests as complete and run the test suite to verify everything works:
There's a build error in the themes package. Let me check what the issue is:
I need to fix the import and use the correct encoding/hex package. Let me update the file:
The import is correct. The issue is how I'm using hex.DecodeString. Let me fix that:
Now let's build again:
Good! Now let's run the tests for just the themes package:
Perfect! All 23 tests pass. Let me check the test coverage:
Excellent! 84.7% coverage, exceeds the 80%+ requirement. Now let's run the full test suite:
Good! The themes tests pass. The TUI test failure is pre-existing (not related to our changes). Now let me format and lint:
Good! Formatting applied. Now let's run go vet:
Perfect! Let me run the linter too:
I need to fix the error checking issues. Let me update the code:
Now let me fix the test file:
Now let's run the linter again:
Great! No errors from linter. Let me run the tests again to ensure everything still passes:
Perfect! All tests pass. Let me verify the coverage is still good:
Excellent! 82.8% coverage (still well above the 80% requirement). Now let me update the spec acceptance criteria and commit. First, let me read the spec file:
Now let me update the acceptance criteria to mark everything as complete:
Now let me also update the target_files in the spec frontmatter since I created themes_test.go as well:
Let me also add the model field to the spec frontmatter:
Perfect! Now let's commit the work:
Let me add and commit:
Excellent! Let me verify the git status is now clean:
Perfect! Let me update the todo list to mark everything as complete:
Perfect! Let me verify the implementation one more time by checking the created files:
Perfect! Let me create a quick summary of what was implemented:

## Implementation Complete ✓

I have successfully implemented the **Custom Color Profiles and Theme System** for moji. Here's what was delivered:

### Core Implementation

**Package: `internal/themes/`**
- **`themes.go`** (285 lines): Complete theme management system
- **`themes_test.go`** (520 lines): Comprehensive unit tests

### Features Delivered

1. **Theme Struct** with Name, Description, Colors (hex strings), and optional Metadata
2. **Core Functions**:
   - `Init()` - Initialize system and auto-load from `~/.config/moji/themes/`
   - `LoadTheme(path)` - Load YAML theme files
   - `LoadThemesDir(dir)` - Load all themes from a directory
   - `SaveTheme(theme, path)` - Save themes to YAML files
   - `RegisterTheme(theme)` - Register themes at runtime
   - `GetTheme(name)` - Retrieve theme by name
   - `ListThemes()` - List all available theme names
   - `HexToRGB(hex)` / `RGBToHex(r, g, b)` - Color conversion utilities

3. **Built-in Themes** (12 hardcoded):
   - rainbow, neon, fire, ice, matrix, sunset, ocean, c64, dracula, vaporwave, retro, pastel

4. **YAML Theme Format**:
   ```yaml
   name: "my-theme"
   description: "Custom neon colors"
   colors:
     - "#FF00FF"
     - "#00FFFF"
     - "#FFFF00"
   metadata:
     author: "user"
   ```

5. **Validation**:
   - Hex color format validation (#RRGGBB, case-insensitive)
   - Theme structure validation (name, description required, at least 1 color)
   - Comprehensive error handling

6. **Auto-Loading**:
   - Scans `~/.config/moji/themes/` on initialization
   - Supports both `.yaml` and `.yml` file extensions
   - Merges user themes with built-in themes
   - Graceful error handling for individual theme load failures

### Testing & Quality

- ✅ **23 comprehensive unit tests** - All passing
- ✅ **82.8% code coverage** (exceeds 80% requirement)
- ✅ **go vet** - Zero errors
- ✅ **golangci-lint** - Zero errors
- ✅ **go fmt** - Properly formatted

### Acceptance Criteria

All 13 criteria met and checked:
- [x] Internal themes package created
- [x] Theme struct with all required fields
- [x] LoadTheme, LoadThemesDir, SaveTheme functions
- [x] GetTheme and ListThemes functions
- [x] RegisterTheme runtime registration
- [x] Auto-load from ~/.config/moji/themes/
- [x] YAML format with hex colors
- [x] Full validation system
- [x] Comprehensive unit tests
- [x] All tools passing

**Commit**: `c5b6657

... (output truncated, 5031 chars total)```
