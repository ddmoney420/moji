---
type: code
status: completed
labels:
- feature
- cli
target_files:
- internal/watch/watch.go
- cmd_banner.go
- cmd_convert.go
- main.go
commits:
- 7686d20
completed_at: 2026-01-29T21:04:17Z
---
# Add Real-time Watch Mode for Live ASCII Art Development

## Problem Description

When developing ASCII art or experimenting with effects, users must manually re-run commands after each source file change. A `--watch` flag would enable real-time updates, improving the creative workflow for banner design, image conversion tuning, and effect experimentation.

## Solution Approach

1. Create `internal/watch/watch.go` using `fsnotify` for cross-platform file watching
2. Add `--watch` flag to relevant subcommands (banner, convert, art)
3. Clear terminal and re-render on file changes
4. Debounce rapid changes (100ms default)
5. Show file change notifications with timestamps

## Acceptance Criteria

- [x] Create `internal/watch/watch.go` with file watcher
- [x] `Watch(path string, callback func()) error` main function
- [x] `WatchMultiple(paths []string, callback func()) error` for multiple files
- [x] Debounce mechanism (configurable, default 100ms)
- [x] `SetDebounce(duration time.Duration)` function
- [x] Graceful shutdown on SIGINT/SIGTERM
- [x] Clear terminal before re-render (optional, default true)
- [x] Add `--watch` flag to `banner` command
- [x] Add `--watch` flag to `convert` command
- [x] Unit tests with 80%+ coverage
- [x] go vet passes with no errors

## Technical Notes

- Use `github.com/fsnotify/fsnotify` for file watching
- Handle both file modifications and directory watching
- Filter events to only trigger on Write operations
- Consider recursive directory watching for art directories

## Agent Output

2026-01-29T21:04:19Z

```
I'll start implementing the watch mode feature for moji. Let me first understand the current codebase structure and then work on the acceptance criteria.
Let me explore the moji codebase structure to understand the project:
Let me check the project structure and look at the main command files:
Now let me look at the banner and convert commands:
Let me check the internal directory structure:
Now let me check the current spec file:
Now let me update my todo list and start implementing:
Let me add the fsnotify dependency:
Great! Now let me create the watch module. First, let me create the directory:
Now let me create the watch.go file with the main watcher functionality:
Now let me update the todo and create unit tests:
Now let me update the todo and run tests:
Let me fix those issues:
Now run the tests again:
Good! We have 82.2% coverage which meets the requirement. The TestWatchDirectory test is failing - let me fix it since directory watching needs to look for write events on files within the directory:
Perfect! All tests pass with 80% coverage. Now let me update the todo and add the --watch flag to the banner command:
Now let me add the --watch flag to the banner command:
Now let me add the handleBannerWatch function:
Now let me update todo and add the --watch flag to the convert command:
Now let me add the handleConvertWatch function:
Now let me verify that the code builds and run go vet:
I need to declare the watchFlag variable. Let me add it to the main file:
Great! Now let me run go vet:
Perfect! Now let me update the acceptance criteria in the spec file:
Now I need to add the model field to the spec frontmatter:
Now let me verify the git status and commit:
Perfect! Let me verify the git status is clean:
Excellent! Let me update the final todo:
Perfect! Let me verify the implementation one more time by running the tests:
Perfect! Let me create a summary of the implementation:

## Summary

I have successfully implemented the real-time watch mode for live ASCII art development in the moji project. Here's what was completed:

### ✅ All Acceptance Criteria Met

1. **Created `internal/watch/watch.go`** with cross-platform file watching using `fsnotify`
   - `Watch(path string, callback func()) error` - single file watcher
   - `WatchMultiple(paths []string, callback func()) error` - multiple file watcher
   - Debounce mechanism with configurable duration (default 100ms)
   - `SetDebounce(duration time.Duration)` function for custom settings
   - Graceful shutdown on SIGINT/SIGTERM signals
   - Terminal clearing before re-render

2. **Added `--watch` flag to banner command** (`cmd_banner.go`)
   - Implements `handleBannerWatch()` function
   - Watches current directory for changes
   - Re-renders banner in real-time

3. **Added `--watch` flag to convert command** (`cmd_convert.go`)
   - Implements `handleConvertWatch()` function
   - Watches image file for changes
   - Re-renders ASCII art conversion in real-time

4. **Comprehensive unit tests** with 80% code coverage
   - 11 test functions covering all main functionality
   - Tests for single/multiple file watching
   - Debounce mechanism testing
   - Error handling and edge cases
   - Concurrent watcher testing

5. **Code quality verification**
   - All tests passing ✓
   - `go vet` passes with no errors ✓
   - Build successful ✓

### Files Modified/Created
- `internal/watch/watch.go` - Main watch module
- `internal/watch/watch_test.go` - Comprehensive test suite
- `cmd_banner.go` - Added --watch flag
- `cmd_convert.go` - Added --watch flag
- `main.go` - Added watchFlag variable
- `go.mod`/`go.sum` - Added fsnotify dependency

### Commit
Created commit `7686d20` with message: `chant(2026-01-29-00a-c7u): Add real-time watch mode for live ASCII art development`

The implementation is complete and ready for use!```
