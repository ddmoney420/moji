---
type: code
status: completed
labels:
- feature
- dsl
target_files:
- internal/chain/parser.go
- internal/chain/pipeline.go
- internal/chain/parser_test.go
- internal/chain/pipeline_test.go
model: claude-haiku-4-5-20251001
---
# Enhance Native Chain Command with Pipeline DSL

## Problem Description

The current chain package uses struct-based options which is verbose. A pipeline DSL would allow expressive command chaining like `moji chain "banner 'Hello' | rainbow | wave | border-double"` for more intuitive effect composition.

## Solution Approach

1. Create `internal/chain/parser.go` with DSL parser
2. Support pipe-separated commands: `cmd1 | cmd2 | cmd3`
3. Support command arguments: `banner 'text'`, `gradient:fire`
4. Create `internal/chain/pipeline.go` for execution
5. Maintain backward compatibility with Options struct

## Acceptance Criteria

- [x] Create `parser.go` with DSL tokenizer and parser
- [x] `Parse(input string) (*Pipeline, error)` function
- [x] Support pipe `|` separator between commands
- [x] Support quoted strings for text arguments
- [x] Support colon notation for variants: `gradient:rainbow`
- [x] Support key=value arguments: `width=80`
- [x] Create `pipeline.go` with Pipeline executor
- [x] `Pipeline.Execute(input string) (string, error)`
- [x] `Pipeline.Steps() []Step` to inspect pipeline
- [x] Map DSL commands to existing functions (banner, gradient, effect, border, bubble)
- [x] Helpful error messages with position info
- [x] Unit tests with 90%+ coverage
- [x] go vet passes with no errors

## Technical Notes

- DSL Grammar:
  ```
  pipeline := step ('|' step)*
  step := command args?
  command := identifier (':' identifier)?
  args := (string | key'='value)*
  ```
- Example: `banner 'Hi' | gradient:fire | border:double padding=2`